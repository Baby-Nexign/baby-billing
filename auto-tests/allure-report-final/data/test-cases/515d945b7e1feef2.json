{"uid":"515d945b7e1feef2","name":"Проверка частичного списания из пакета и деньгами (ТП 'Помесячный', внутрисеть)","fullName":"tests.test_e2e_monthly_02#test_e2e_monthly_02_partial_package_deduction_and_billing","historyId":"64dfe4dfe837e88f8faf0979a9a39c35","time":{"start":1746919841012,"stop":1746919849396,"duration":8384},"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\n    длительность которого превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n    3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\n    Шаги:\n    1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n    2. Отправка CDR о звонке в RabbitMQ.\n    3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n    6. Проверка неизменности баланса принимающего абонента (P1).\n","descriptionHtml":"<pre><code>Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\nдлительность которого превышает остаток минут в пакете.\nОжидаемое поведение:\n1. Имеющиеся пакетные минуты списываются полностью.\n2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\nШаги:\n1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n2. Отправка CDR о звонке в RabbitMQ.\n3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n4. Проверка полного списания пакетных минут у звонящего (P2).\n5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n6. Проверка неизменности баланса принимающего абонента (P1).\n</code></pre>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"reset_sequences_after_migrations","time":{"start":1746919820654,"stop":1746919820676,"duration":22},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_connection","time":{"start":1746919840983,"stop":1746919841011,"duration":28},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\n    длительность которого превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n    3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\n    Шаги:\n    1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n    2. Отправка CDR о звонке в RabbitMQ.\n    3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n    6. Проверка неизменности баланса принимающего абонента (P1).\n","status":"passed","steps":[{"name":"1. Подготовка данных абонентов (P2 - Помесячный, P1 - Классика)","time":{"start":1746919841012,"stop":1746919841060,"duration":48},"status":"passed","steps":[],"attachments":[{"uid":"a93441244786879","name":"Данные абонента P2 (звонящий, вход)","source":"a93441244786879.json","type":"application/json","size":205},{"uid":"de98b9137f3ea3e9","name":"Данные абонента P1 (принимающий, вход)","source":"de98b9137f3ea3e9.json","type":"application/json","size":205},{"uid":"967a60f0ee00200d","name":"ID созданного/обновленного абонента P2","source":"967a60f0ee00200d.txt","type":"text/plain","size":25}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},{"name":"2. Отправка CDR: 79221234567 -> 79340001122, Начало: 2025-05-01T14:00:00, Конец: 2025-05-01T14:04:59","time":{"start":1746919841061,"stop":1746919841084,"duration":23},"status":"passed","steps":[],"attachments":[{"uid":"a628e7f08de79fbb","name":"Отправляемый CDR","source":"a628e7f08de79fbb.json","type":"application/json","size":171}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"3. Расчеты: общая длительность, минуты из пакета, минуты сверх пакета, стоимость сверх пакета","time":{"start":1746919841085,"stop":1746919841087,"duration":2},"status":"passed","steps":[],"attachments":[{"uid":"8f42ea0e38b10c5d","name":"Общая длительность","source":"8f42ea0e38b10c5d.txt","type":"text/plain","size":81},{"uid":"e0ecd7087fff23e5","name":"Минуты из пакета","source":"e0ecd7087fff23e5.txt","type":"text/plain","size":56},{"uid":"b224b88190cfafbd","name":"Минуты сверх пакета","source":"b224b88190cfafbd.txt","type":"text/plain","size":85},{"uid":"fd880f1a51ab4b8","name":"Стоимость минут сверх пакета","source":"fd880f1a51ab4b8.txt","type":"text/plain","size":141}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},{"name":"Пауза 7 сек. для обработки биллинга","time":{"start":1746919841087,"stop":1746919849392,"duration":8305},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"4. Проверка пакетных минут у звонящего абонента P2 (79221234567)","time":{"start":1746919849393,"stop":1746919849394,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"1a721e5404477531","name":"Детали пакетных минут P2 (79221234567)","source":"1a721e5404477531.txt","type":"text/plain","size":174}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"5. Проверка денежного баланса у звонящего абонента P2 (79221234567)","time":{"start":1746919849394,"stop":1746919849395,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"3aae0372c9a55fa4","name":"Детали денежного баланса P2 (79221234567)","source":"3aae0372c9a55fa4.txt","type":"text/plain","size":238}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"6. Проверка баланса принимающего абонента P1 (79340001122) - не должен измениться","time":{"start":1746919849395,"stop":1746919849396,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"9828f8ef0014c85","name":"Детали баланса P1 (79340001122)","source":"9828f8ef0014c85.txt","type":"text/plain","size":112}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"37cc4c3baea3ea99","name":"log","source":"37cc4c3baea3ea99.txt","type":"text/plain","size":1663},{"uid":"a333166de0136b76","name":"stderr","source":"a333166de0136b76.txt","type":"text/plain","size":1647}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":7,"attachmentsCount":13,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"db_connection::0","time":{"start":1746919849397,"stop":1746919849397,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"story","value":"E2E-MONTHLY-02: Частичное списание из пакета, остаток деньгами (внутрисеть)"},{"name":"severity","value":"critical"},{"name":"feature","value":"Тариф 'Помесячный'"},{"name":"epic","value":"Биллинг"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_e2e_monthly_02"},{"name":"host","value":"imenov"},{"name":"thread","value":"330609-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_e2e_monthly_02"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[],"tags":[]},"source":"515d945b7e1feef2.json","parameterValues":[]}