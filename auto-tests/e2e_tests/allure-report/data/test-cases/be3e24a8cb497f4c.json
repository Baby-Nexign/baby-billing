{"uid":"be3e24a8cb497f4c","name":"Проверка списания из пакета и деньгами (ТП 'Помесячный', звонок на внешнюю сеть)","fullName":"tests.test_e2e_monthly_03#test_e2e_monthly_03_partial_package_and_external_billing","historyId":"499472a860e95cc23fd323927969e9c7","time":{"start":1746919849412,"stop":1746919856436,"duration":7024},"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий звонок\n    на номер ВНЕШНЕГО оператора, и длительность звонка превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса\n       по тарифу для звонков на внешние сети сверх пакета.\n    Шаги:\n    1. Создание/обновление данных звонящего абонента (P2, Помесячный).\n    2. Отправка CDR о звонке на внешний номер в RabbitMQ.\n    3. Расчет общей длительности, минут из пакета, минут сверх пакета и стоимости минут сверх пакета (для внешних вызовов).\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n","descriptionHtml":"<pre><code>Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий звонок\nна номер ВНЕШНЕГО оператора, и длительность звонка превышает остаток минут в пакете.\nОжидаемое поведение:\n1. Имеющиеся пакетные минуты списываются полностью.\n2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса\n   по тарифу для звонков на внешние сети сверх пакета.\nШаги:\n1. Создание/обновление данных звонящего абонента (P2, Помесячный).\n2. Отправка CDR о звонке на внешний номер в RabbitMQ.\n3. Расчет общей длительности, минут из пакета, минут сверх пакета и стоимости минут сверх пакета (для внешних вызовов).\n4. Проверка полного списания пакетных минут у звонящего (P2).\n5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n</code></pre>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"reset_sequences_after_migrations","time":{"start":1746919820654,"stop":1746919820676,"duration":22},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_connection","time":{"start":1746919849400,"stop":1746919849411,"duration":11},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий звонок\n    на номер ВНЕШНЕГО оператора, и длительность звонка превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса\n       по тарифу для звонков на внешние сети сверх пакета.\n    Шаги:\n    1. Создание/обновление данных звонящего абонента (P2, Помесячный).\n    2. Отправка CDR о звонке на внешний номер в RabbitMQ.\n    3. Расчет общей длительности, минут из пакета, минут сверх пакета и стоимости минут сверх пакета (для внешних вызовов).\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n","status":"passed","steps":[{"name":"1. Подготовка данных звонящего абонента P2 (Помесячный)","time":{"start":1746919849412,"stop":1746919849420,"duration":8},"status":"passed","steps":[],"attachments":[{"uid":"5bea23cf73a04fba","name":"Данные абонента P2 (вход)","source":"5bea23cf73a04fba.json","type":"application/json","size":205},{"uid":"553afbf775fb1a43","name":"ID созданного/обновленного абонента P2","source":"553afbf775fb1a43.txt","type":"text/plain","size":25}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},{"name":"2. Отправка CDR: 79222226662 -> 79888888888 (внешний), Начало: 2025-05-01T15:00:00, Конец: 2025-05-01T15:04:59","time":{"start":1746919849420,"stop":1746919849430,"duration":10},"status":"passed","steps":[],"attachments":[{"uid":"a2dcfa22b0733050","name":"Отправляемый CDR (на внешнюю сеть)","source":"a2dcfa22b0733050.json","type":"application/json","size":171}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"3. Расчеты: общая длительность, минуты из пакета, минуты сверх пакета, стоимость (внешний тариф)","time":{"start":1746919849430,"stop":1746919849432,"duration":2},"status":"passed","steps":[],"attachments":[{"uid":"456729dab59f8065","name":"Общая длительность","source":"456729dab59f8065.txt","type":"text/plain","size":81},{"uid":"1f28cc71cebfe85a","name":"Минуты из пакета","source":"1f28cc71cebfe85a.txt","type":"text/plain","size":56},{"uid":"9d5cc434d165cef3","name":"Минуты сверх пакета","source":"9d5cc434d165cef3.txt","type":"text/plain","size":85},{"uid":"f6cb8d2601dfeece","name":"Стоимость минут сверх пакета (внешний)","source":"f6cb8d2601dfeece.txt","type":"text/plain","size":158}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},{"name":"Пауза 7 сек. для обработки биллинга","time":{"start":1746919849432,"stop":1746919856432,"duration":7000},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"4. Проверка пакетных минут у звонящего абонента P2 (79222226662)","time":{"start":1746919856432,"stop":1746919856435,"duration":3},"status":"passed","steps":[],"attachments":[{"uid":"15d010e43223075c","name":"Детали пакетных минут P2 (79222226662)","source":"15d010e43223075c.txt","type":"text/plain","size":174}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"5. Проверка денежного баланса у звонящего абонента P2 (79222226662)","time":{"start":1746919856435,"stop":1746919856436,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"be26db3ecdf403eb","name":"Детали денежного баланса P2 (79222226662)","source":"be26db3ecdf403eb.txt","type":"text/plain","size":255}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"ec24a1d5bf30e748","name":"log","source":"ec24a1d5bf30e748.txt","type":"text/plain","size":1305},{"uid":"3b7855c3d6ffa0e5","name":"stderr","source":"3b7855c3d6ffa0e5.txt","type":"text/plain","size":1287}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":11,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"db_connection::0","time":{"start":1746919856437,"stop":1746919856438,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"feature","value":"Тариф 'Помесячный'"},{"name":"severity","value":"critical"},{"name":"story","value":"E2E-MONTHLY-03: Частичное списание из пакета, остаток деньгами (внешняя сеть)"},{"name":"epic","value":"Биллинг"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_e2e_monthly_03"},{"name":"host","value":"imenov"},{"name":"thread","value":"330609-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_e2e_monthly_03"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[],"tags":[]},"source":"be3e24a8cb497f4c.json","parameterValues":[]}