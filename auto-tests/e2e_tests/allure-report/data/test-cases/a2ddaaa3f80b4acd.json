{"uid":"a2ddaaa3f80b4acd","name":"Проверка частичного списания из пакета и деньгами (ТП 'Помесячный', внутрисеть)","fullName":"tests.test_e2e_monthly_02#test_e2e_monthly_02_partial_package_deduction_and_billing","historyId":"64dfe4dfe837e88f8faf0979a9a39c35","time":{"start":1746919841012,"stop":1746919849396,"duration":8384},"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\n    длительность которого превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n    3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\n    Шаги:\n    1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n    2. Отправка CDR о звонке в RabbitMQ.\n    3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n    6. Проверка неизменности баланса принимающего абонента (P1).\n","descriptionHtml":"<pre><code>Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\nдлительность которого превышает остаток минут в пакете.\nОжидаемое поведение:\n1. Имеющиеся пакетные минуты списываются полностью.\n2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\nШаги:\n1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n2. Отправка CDR о звонке в RabbitMQ.\n3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n4. Проверка полного списания пакетных минут у звонящего (P2).\n5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n6. Проверка неизменности баланса принимающего абонента (P1).\n</code></pre>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"reset_sequences_after_migrations","time":{"start":1746919820654,"stop":1746919820676,"duration":22},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_connection","time":{"start":1746919840983,"stop":1746919841011,"duration":28},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Тест проверяет сценарий, когда абонент с 'Помесячным' тарифом совершает исходящий внутрисетевой звонок,\n    длительность которого превышает остаток минут в пакете.\n    Ожидаемое поведение:\n    1. Имеющиеся пакетные минуты списываются полностью.\n    2. Оставшаяся часть длительности звонка тарифицируется с денежного баланса по соответствующему тарифу.\n    3. Баланс принимающего абонента (если он внутрисетевой) не изменяется.\n    Шаги:\n    1. Создание/обновление данных звонящего (P2, Помесячный) и принимающего (P1, Классика) абонентов.\n    2. Отправка CDR о звонке в RabbitMQ.\n    3. Расчет общей длительности звонка, минут из пакета, минут сверх пакета и стоимости минут сверх пакета.\n    4. Проверка полного списания пакетных минут у звонящего (P2).\n    5. Проверка корректного списания средств с денежного баланса звонящего (P2).\n    6. Проверка неизменности баланса принимающего абонента (P1).\n","status":"passed","steps":[{"name":"1. Подготовка данных абонентов (P2 - Помесячный, P1 - Классика)","time":{"start":1746919841012,"stop":1746919841060,"duration":48},"status":"passed","steps":[],"attachments":[{"uid":"c2fa550fd8dd6175","name":"Данные абонента P2 (звонящий, вход)","source":"c2fa550fd8dd6175.json","type":"application/json","size":205},{"uid":"44bbad599963a1bf","name":"Данные абонента P1 (принимающий, вход)","source":"44bbad599963a1bf.json","type":"application/json","size":205},{"uid":"feec9f4879379446","name":"ID созданного/обновленного абонента P2","source":"feec9f4879379446.txt","type":"text/plain","size":25}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":3,"hasContent":true,"attachmentStep":false},{"name":"2. Отправка CDR: 79221234567 -> 79340001122, Начало: 2025-05-01T14:00:00, Конец: 2025-05-01T14:04:59","time":{"start":1746919841061,"stop":1746919841084,"duration":23},"status":"passed","steps":[],"attachments":[{"uid":"7ea7c42637107a8b","name":"Отправляемый CDR","source":"7ea7c42637107a8b.json","type":"application/json","size":171}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"3. Расчеты: общая длительность, минуты из пакета, минуты сверх пакета, стоимость сверх пакета","time":{"start":1746919841085,"stop":1746919841087,"duration":2},"status":"passed","steps":[],"attachments":[{"uid":"6efb57bbe55cd951","name":"Общая длительность","source":"6efb57bbe55cd951.txt","type":"text/plain","size":81},{"uid":"708c8f1507192856","name":"Минуты из пакета","source":"708c8f1507192856.txt","type":"text/plain","size":56},{"uid":"455690492c665bd0","name":"Минуты сверх пакета","source":"455690492c665bd0.txt","type":"text/plain","size":85},{"uid":"642a7819ff0343b4","name":"Стоимость минут сверх пакета","source":"642a7819ff0343b4.txt","type":"text/plain","size":141}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":4,"hasContent":true,"attachmentStep":false},{"name":"Пауза 7 сек. для обработки биллинга","time":{"start":1746919841087,"stop":1746919849392,"duration":8305},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"4. Проверка пакетных минут у звонящего абонента P2 (79221234567)","time":{"start":1746919849393,"stop":1746919849394,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"fc87c8d6f8c3d5ee","name":"Детали пакетных минут P2 (79221234567)","source":"fc87c8d6f8c3d5ee.txt","type":"text/plain","size":174}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"5. Проверка денежного баланса у звонящего абонента P2 (79221234567)","time":{"start":1746919849394,"stop":1746919849395,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"75ba95c4274d3fb4","name":"Детали денежного баланса P2 (79221234567)","source":"75ba95c4274d3fb4.txt","type":"text/plain","size":238}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"6. Проверка баланса принимающего абонента P1 (79340001122) - не должен измениться","time":{"start":1746919849395,"stop":1746919849396,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"4ae1c53e2e94d23","name":"Детали баланса P1 (79340001122)","source":"4ae1c53e2e94d23.txt","type":"text/plain","size":112}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[{"uid":"734c461b32735abf","name":"log","source":"734c461b32735abf.txt","type":"text/plain","size":1663},{"uid":"c4eaf07bdfd1379f","name":"stderr","source":"c4eaf07bdfd1379f.txt","type":"text/plain","size":1647}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":7,"attachmentsCount":13,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"db_connection::0","time":{"start":1746919849397,"stop":1746919849397,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"story","value":"E2E-MONTHLY-02: Частичное списание из пакета, остаток деньгами (внутрисеть)"},{"name":"severity","value":"critical"},{"name":"feature","value":"Тариф 'Помесячный'"},{"name":"epic","value":"Биллинг"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_e2e_monthly_02"},{"name":"host","value":"imenov"},{"name":"thread","value":"330609-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_e2e_monthly_02"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"critical","retries":[],"categories":[],"tags":[]},"source":"a2ddaaa3f80b4acd.json","parameterValues":[]}